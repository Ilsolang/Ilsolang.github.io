<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="http://localhost:4000/assets/css/syntax.css"><link rel="preconnect" href="https://cdnjs.cloudflare.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><title> Fast API — How to build a grocery list - Ilya Semenov</title><link rel="shortcut icon" href="http://localhost:4000/favicon.png"><link rel="alternate" type="application/atom+xml" title="Ilya Semenov" href="http://localhost:4000/atom.xml"><link rel="alternate" type="application/json" title="Ilya Semenov" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="http://localhost:4000/sitemap.xml" /><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap" rel="stylesheet"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}html{font-size:15px}#theme-toggle{opacity:0.65;position:relative;border-radius:5px;height:25px;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;transition:opacity 0.3s ease 0s;border:none;outline:none;background:none;cursor:pointer;padding:0px;appearance:none;transform:scale(0.8)}html,html[data-theme="light"]{--very-light-text-color: rgb(222, 222, 222);--light-text-color: rgb(89, 183, 255);--medium-text-color: #555;--main-text-color: #333;--dark-text-color: #393e46;--link-color: rgb(50, 87, 209);--code-bg-color: rgb(245, 245, 245);background-color:#fff}html #theme-toggle div,html[data-theme="light"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:none;background-color:var(--theme-ui-colors-transparent, transparent);transform:scale(1);transition:all 0.45s ease 0s;overflow:hidden;box-shadow:inset 8px -8px 0px 0px var(--theme-ui-colors-toggleIcon, #2d3748)}html #theme-toggle div::before,html[data-theme="light"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:none;border-radius:50%;transform:translate(0px, 0px);opacity:1;transition:transform 0.45s ease 0s}html #theme-toggle div::after,html[data-theme="light"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),0 23px 0 var(--theme-ui-colors-toggleIcon, #2d3748),23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),-23px 0 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #2d3748);transform:scale(0);transition:all 0.35s ease 0s}html[data-theme="dark"]{--very-light-text-color: #EEE;--light-text-color: #c4bbf0;--medium-text-color: #52057b;--main-text-color: #EAEAEA;--dark-text-color: rgb(36, 38, 42);--link-color: rgb(255, 89, 125);--code-bg-color: rgb(36, 38, 42);background-color:#131418}html[data-theme="dark"] #theme-toggle div{position:relative;width:24px;height:24px;border-radius:50%;border:4px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);background-color:var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(0.55);transition:all 0.45s ease 0s;overflow:visible;box-shadow:none}html[data-theme="dark"] #theme-toggle div::before{content:"";position:absolute;right:-9px;top:-9px;height:24px;width:24px;border:2px solid var(--theme-ui-colors-toggleIcon, #cbd5e0);border-radius:50%;transform:translate(14px, -14px);opacity:0;transition:transform 0.45s ease 0s}html[data-theme="dark"] #theme-toggle div::after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0px 0px -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),0 23px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-23px 0 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px 15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0),-15px -15px 0 var(--theme-ui-colors-toggleIcon, #cbd5e0);transform:scale(1);transition:all 0.35s ease 0s}body{font-family:"Fira Code", monospace;text-rendering:optimizeLegibility;line-height:1.75;color:var(--main-text-color)}a{color:var(--link-color);text-decoration:none}.post p{margin:1rem 0}.meta{margin:1.4rem 0}code,pre{background:var(--code-bg-color);margin:0 -27px;border-width:1px}code{margin:unset;padding:0.1rem;color:var(--light-text-color)}pre code{background-color:unset;color:unset}pre{border-width:3px;padding:0.8rem;white-space:pre-wrap;border-style:none none none solid;border-color:var(--light-text-color)}img{max-width:100%}hr{background:var(--light-text-color);height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem 0}section{margin-top:5.5rem}blockquote{font-style:italic;border-left:5px solid var(--dark-text-color);padding-left:1rem}h1{color:var(--main-text-color);text-transform:uppercase;font-size:larger;font-weight:bold;margin-bottom:1.5rem}h2,h3,h4,h5{font-weight:bold;font-size:1rem;margin-bottom:1.5rem}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts>h3{font-weight:500}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}time{color:var(--main-text-color)}.post>h1.title{font-size:x-large;margin-top:0;margin-bottom:0}.post>time{margin-bottom:0;margin-top:3rem}main{display:flex;max-width:47rem;margin:-5rem auto 0;padding:2.4rem 2rem;flex-direction:column}.flex-row-between{display:flex;flex-direction:row;justify-content:space-between}.social-footer{padding:1rem;display:flex;justify-content:center;position:initial}.social-footer .social-footer-icons .fa{font-size:1.3rem;color:#a9a9a9}.social-footer .social-footer-icons .fa:hover{color:dimgray;transition:color 0.3s ease-in}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}main{padding:0 2rem}}section{flex-grow:999;display:flex;flex-direction:column}figcaption{font-size:smaller}.bio{margin-bottom:5rem;text-align:justify}::selection{background-color:#fffba0;color:#333}.search-article{position:relative}.search-article label[for="search-input"]{position:relative;top:-10px;left:11px}.search-article input[type="search"]{top:-1rem;left:0;border:0;width:100%;height:30px;outline:none;position:absolute;border-radius:5px;padding:10px 10px 10px 35px;color:var(--main-text-color);-webkit-appearance:none;background-color:rgba(128,128,128,0.1);border:1px solid rgba(128,128,128,0.1)}.search-article input[type="search"]::-webkit-input-placeholder{color:#808080}.search-article input[type="search"]::-webkit-search-decoration,.search-article input[type="search"]::-webkit-search-results-decoration{display:none}#search-results{text-align:center}#search-results li{text-align:center}.post-nav{display:flex;position:relative;margin-top:0;border-top:2px solid var(--light-text-color);line-height:1.4}.post-nav .post-nav-item{border-bottom:0;padding-bottom:10px;width:50%;padding-top:10px;text-decoration:none;box-sizing:border-box}.post-nav .post-nav-item .post-title{color:var(--main-text-color)}.post-nav .post-nav-item:hover .post-title,.post-nav .post-nav-item:focus .post-title{color:var(--link-color);opacity:0.9}.post-nav .post-nav-item .nav-arrow{font-size:17px;color:var(--main-text-color);margin-bottom:3px;font-weight:bold}.post-nav .post-nav-item:nth-child(odd){padding-left:0;padding-right:20px}.post-nav .post-nav-item:nth-child(even){text-align:right;padding-right:0;padding-left:20px}.tags ul{list-style:none;display:grid;grid-template-columns:auto auto auto auto auto auto;grid-template-rows:auto auto auto auto}.tags li{white-space:normal;text-overflow:ellipsis}.timeline{position:center;width:650px;margin:-6em auto;padding:1px;list-style-type:none}@media (max-width: 860px){.timeline{width:100%}}.timeline:before{position:absolute;left:50%;top:0;content:' ';display:block;width:6px;height:100%;margin-left:-3px;background:var(--light-text-color);z-index:5}@media (max-width: 375px){.timeline:before{height:150%}}.timeline li{padding:2em 0}@media (max-width: 860px){.timeline li{padding:2em 0}}.timeline li::after{content:"";display:block;clear:both;visibility:hidden}.direction-l{position:relative;width:287px;float:left;text-align:right}@media (max-width: 860px){.direction-l{float:none;width:100%;text-align:center}}.direction-l .flag{color:#333;box-shadow:-1px 1px 1px rgba(0,0,0,0.52)}.direction-l .flag:after{content:"";position:absolute;left:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-left-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-l .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-l .time-wrapper{float:left}@media (max-width: 860px){.direction-l .time-wrapper{float:none}}.direction-r{position:relative;width:293px;float:right;text-align:left}@media (max-width: 860px){.direction-r{float:none;width:100%;text-align:center}}.direction-r .flag{color:#333;box-shadow:1px 1px 1px rgba(0,0,0,0.52)}.direction-r .flag:after{content:"";position:absolute;right:100%;top:50%;height:0;width:0;margin-top:-8px;border:solid transparent;border-right-color:#f8f8f8;border-width:8px;pointer-events:none}@media (max-width: 860px){.direction-r .flag:after{content:"";position:absolute;left:50%;top:-8px;height:0;width:0;margin-left:-8px;border:solid transparent;border-bottom-color:#fff;border-width:8px;pointer-events:none}}.direction-r .flag:before{left:-40px}.direction-r .time-wrapper{float:right}@media (max-width: 860px){.direction-r .time-wrapper{float:none}}.flag-wrapper{position:relative;display:inline-block;text-align:center}@media (max-width: 860px){.flag-wrapper{text-align:center}}.flag-wrapper .flag{position:relative;display:inline;background:#f8f8f8;padding:6px 10px;border-radius:5px;font-weight:600;text-align:left}@media (max-width: 860px){.flag-wrapper .flag{background:#fff;z-index:15}}.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:60%;right:-40px;content:' ';display:block;width:12px;height:12px;margin-top:-10px;background:#fff;border-radius:10px;border:4px solid var(--link-color);z-index:10}@media (max-width: 860px){.direction-l .flag:before,.direction-r .flag:before{position:absolute;top:-30px;left:53%;content:' ';display:block;margin-left:-10px}}.time-wrapper{display:inline;line-height:1em;font-size:0.66666em;color:var(--link-color);vertical-align:middle}@media (max-width: 860px){.time-wrapper{display:block;position:relative;margin:4px 0 0 0;z-index:14}}.time-wrapper .time{display:inline-block;padding:4px 6px;background:#f8f8f8}.desc{margin:1em 0.2em -3.5em 0;font-size:0.9em;line-height:1.5em}.desc a{color:var(--link-color);text-decoration:none}.desc a:hover{text-decoration:underline}@media (max-width: 860px){.desc{position:relative;margin:1em 1em 0 1em;padding:1em;background:var(--code-bg-color);box-shadow:0 0 1px rgba(0,0,0,0.2);z-index:15}}</style></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-3EP7KLCYVP"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-3EP7KLCYVP'); </script><body><main><section class="post"><div class="flex-row-between"> <a href="http://localhost:4000/">« back</a> <button title="Change theme" id="theme-toggle" onclick="modeSwitcher()"><div></div></button></div><time datetime="2021-09-14T00:00:00+00:00">Sep 14, 2021 - 5' reading</time><h1 class="title"> Fast API — How to build a grocery list</h1><span class="meta"> <a href="http://localhost:4000/tag/typography">typography</a></span><p><img src="http://localhost:4000/assets/images/fastapi-grocery-list/wallpaper.jpeg" alt="Wallpaper" /></p><blockquote><p>This article is also available on <a href="https://medium.com/artificialis/fast-api-how-to-build-a-grocery-list-ee51d65f5bf2">medium</a>.</p></blockquote><p>I recently approached Fast API and I realized that is an extremely useful, powerful, and easy-to-use web framework. Compared to Flask, it is much faster because it is built over Asynchronous Server Gateway Interface (ASGI) instead of Web Server Gateway Interface (WSGI). You can read something more about it in the following medium article: “<a href="https://medium.com/analytics-vidhya/difference-between-wsgi-and-asgi-807158ed1d4c">Difference between WSGI and ASGI?</a>”.</p><p>Today I explain a simple way for implementing a grocery list with FastAPI. Obviously, once you understand the basics of this framework, “the sky’s the limit!”</p><p>First, we should start mentioning the CRUD operations, that are:</p><ul><li>CREATE: create a new item</li><li>READ: retrieve all our items</li><li>UPDATE: update the quantity of a given item that we need to buy</li><li>DELETE: delete a given item</li></ul><p><br /></p><blockquote><p>The code of this tutorial can be found in <a href="https://github.com/francescodisalvo05/fastapi-grocery-list">this</a> repository.</p></blockquote><p><br /><br /></p><h2 id="structure"> Structure <a href="#structure">#</a></h2><p>This is the structure that I have used in my repository: ↳ app : <strong>init</strong>.py | app.py ↳ test.py : <strong>init</strong>.py | test_main.py main.py</p><p><br /><br /></p><h2 id="get-post-put-delete"> GET, POST, PUT, DELETE <a href="#get-post-put-delete">#</a></h2><p>The foundations of the requests that took place on the web lie in Hypertext Transfer Protocol (HTTP). It manages all the communications between <strong>clients</strong> (the ones that request a resource) and <strong>servers</strong> (the ones that own the resources).</p><p>Two of the most common <strong>HTTP</strong> methods are <strong>GET</strong> and <strong>POST</strong>. The major difference among them is that <strong>GET</strong> is used for requesting data to the server whereas POST is used for sending data to the server.</p><p>If you want to know something more, I suggest you have a look at <a href="https://www.w3schools.com/tags/ref_httpmethods.asp">W3Schools</a>. This website has been a bible for me while I was in high school and I was learning the Web Development stack.</p><p>Moreover, we also have <strong>PUT</strong> and <strong>DELETE</strong>. PUT is used for updating an instance on the server whereas DELETE is used, as you may imagine, for deleting an existing item. <br /><br /></p><h2 id="api-and-json"> API and JSON <a href="#api-and-json">#</a></h2><p>An Application Programming Interface (API) is a software that allows the communication between two applications. JavaScript Object Notation (JSON), on the other hand, is a text format based on “key-value” pairs separated by commas. Here’s an example:</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Francesco"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"surname"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Di Salvo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"interests"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"AI"</span><span class="p">,</span><span class="s2">"Data Science"</span><span class="p">,</span><span class="s2">"Finance"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p>The reason why I am mentioning them both together is that JSON is commonly used for communication among applications through APIs. The main advantage of using JSON is that it is easily parsed by the machines and interpreted by us! <br /><br /></p><h2 id="requirements"> Requirements <a href="#requirements">#</a></h2><p>To facilitate you, I uploaded the requirements <a href="https://github.com/francescodisalvo05/fastapi-grocery-list/blob/main/requirements.txt">here</a>. Therefore, once you have created your own virtual environment, you can simply install them with:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="p">.</span><span class="n">txt</span>
</code></pre></div></div><p><br /><br /></p><h2 id="mainpy"> main.py <a href="#mainpy">#</a></h2><p>Here we define our <strong>uvicorn</strong> server, which will run on localhost on <strong>port 8000</strong>. Notice that the option “reload=True” means that we are in debugging mode, Pay attention that <strong>it must be turned to False in production</strong>! It means that every time we change something on our code the server will be restarted.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">uvicorn</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">uvicorn</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"app.app:app"</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="nb">reload</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div><p><br /><br /></p><h2 id="apppy---create"> app.py - CREATE <a href="#apppy---create">#</a></h2><p>Here the magic begins. First, we need to define our FastAPI application and then, we can start implementing our routes. For the sake of simplicity, we will not use any persistent memory but we will just use a list of dictionaries as our basket items.</p><p>As we mentioned before, since we want to send data to the server we need to use a POST method. Now, we need to define an input dictionary, that will be sent from the client.</p><p>From the input dictionary, we need the key-value pairs for the <strong>item</strong> and <strong>qty</strong> (quantity). Therefore, assuming the input keys are correct, we have two scenarios:</p><ol><li>The item already exists: we raise a 400 error</li><li>The item does not exist: we add it to our list, and we send a 201 status code</li></ol><blockquote><p>For the status code you can also check <a href="https://fastapi.tiangolo.com/tutorial/response-status-code/">this</a> resource.</p></blockquote><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="n">grocery_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s">"item"</span> <span class="p">:</span> <span class="s">"bread"</span><span class="p">,</span> <span class="s">"qty"</span> <span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"item"</span> <span class="p">:</span> <span class="s">"milk"</span><span class="p">,</span> <span class="s">"qty"</span> <span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">]</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'/create'</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">add_item</span><span class="p">(</span><span class="n">item</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="s">"""Creates a new item to buy
    Args:
        item (dict): {"item" : (str), "qty" : (int)}
    
    Returns:
        notification, code 201
    Raises:
        HTTPException 400, if the element is already present on the list
    """</span>

    <span class="k">for</span> <span class="n">temp_item</span> <span class="ow">in</span> <span class="n">grocery_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">temp_item</span><span class="p">[</span><span class="s">'item'</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span><span class="p">[</span><span class="s">'item'</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s">'item'</span><span class="p">]</span><span class="si">}</span><span class="s"> already present!"</span><span class="p">)</span>

    <span class="n">grocery_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s">"data"</span> <span class="p">:</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s">'item'</span><span class="p">]</span><span class="si">}</span><span class="s"> added correctly!"</span><span class="p">}</span>
</code></pre></div></div><p><br /><br /></p><h2 id="apppy---read"> app.py - READ <a href="#apppy---read">#</a></h2><p>Now, we want to define a route for reading all our inserted items. We do not need to send data on the network. Therefore, we can use a GET method. So, the associated method will simply return our list of dictionaries under the key data.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/list'</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_list</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="s">"""Gets the whole grocery list
    
    Returns:
        Dictionary containing the list of items under the key "data"
    """</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"data"</span><span class="p">:</span><span class="n">grocery_list</span><span class="p">}</span>
</code></pre></div></div><p><br /><br /></p><h2 id="apppy--update"> app.py — UPDATE <a href="#apppy--update">#</a></h2><p>The third operation is UPDATE, for which we update the quantity of a given item already present on our current list. Recall from before that to update an instance we use the PUT method.</p><p>Here we have the opposite situation of CREATE. We should raise an error if the item is not present on our list (because we cannot update it) and we can proceed otherwise.</p><p>Instead of using a body, now we use two items that will be given through the URL. We are waiting for “item_name” and “item_quantity”.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">'/update'</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">update_item</span><span class="p">(</span><span class="n">item_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">item_quantity</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="s">"""Updates the quantity to buy for a given item
    Args:
        item_name (str) : name of the item to update
        item_quantity (int) : quantity to update
    Returns:
        notification, code 200
    Raises:
         HTTPException 404, if the item is not present on the list
    """</span>

    <span class="k">for</span> <span class="n">temp_item</span> <span class="ow">in</span> <span class="n">grocery_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">temp_item</span><span class="p">[</span><span class="s">'item'</span><span class="p">]</span> <span class="o">==</span> <span class="n">item_name</span><span class="p">:</span>
            <span class="n">temp_item</span><span class="p">[</span><span class="s">'qty'</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_quantity</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">"data"</span> <span class="p">:</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">item_name</span><span class="si">}</span><span class="s"> correctly updated!"</span><span class="p">}</span>

    <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">item_name</span><span class="si">}</span><span class="s"> not found!"</span><span class="p">)</span>
<span class="n">view</span> <span class="n">rawapp</span><span class="p">.</span><span class="n">py</span> <span class="n">hosted</span> <span class="k">with</span> <span class="err">❤</span> <span class="n">by</span> <span class="n">GitHub</span>
</code></pre></div></div><p><br /><br /></p><h2 id="apppy--delete"> app.py — DELETE <a href="#apppy--delete">#</a></h2><p>Finally, according to the CRUD paradigm we have to take care of the last operation, DELETE. Its corresponding method is DELETE, and we proceed as before. Now, instead of giving both “item_name” and “item_quantity” we give just “item_name”.</p><p>However, to mess up everything a little bit, let’s see a different way for retrieving the item to delete. In particular, we may also give it in a parametric way through the route.</p><p>For example, we may delete the item “water” by simply using the following request:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/delete/water
</code></pre></div></div><p>Therefore, we use the name of the parameter inside the braces, and it can be used inside the method.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="s">'/delete/{item_name}'</span><span class="p">,</span><span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">delete_item</span><span class="p">(</span><span class="n">item_name</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="s">"""Deletes item with a given iten_name
    Args:
        item_name (str) : name of the item that must be removed
    
    Returns:
        notification, code 200
    Raises:
        HTTPException 404, if the item is not present on the list
    """</span>
    <span class="k">for</span> <span class="n">temp_item</span> <span class="ow">in</span> <span class="n">grocery_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">temp_item</span><span class="p">[</span><span class="s">'item'</span><span class="p">]</span> <span class="o">==</span> <span class="n">item_name</span><span class="p">:</span>
            <span class="n">grocery_list</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temp_item</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">"data"</span> <span class="p">:</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">item_name</span><span class="si">}</span><span class="s"> correctly deleted!"</span><span class="p">}</span>

    <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">item_name</span><span class="si">}</span><span class="s"> not found!"</span><span class="p">)</span>
</code></pre></div></div><p><br /><br /></p><h2 id="testing"> Testing <a href="#testing">#</a></h2><p>Once we defined all these operations we may want to test them. There are several ways to do that and probably the most common way is through Postman. Alternatively, FastAPI provides a very intuitive GUI from the route /docs. Otherwise, we can always use our old friend pytest.</p><p>To define methods recognized as tests, we have to call the python file with “test_fileToTest.py”, so we define our “test_main.py”. Then, each method will be called with “test_stuffToTest()”.</p><p>For example, I want to test the creation of an item. We have two possibilities: the item already exists or not. Therefore, it is a common practice to test all the possible scenarios.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span> <span class="nn">app.app</span> <span class="kn">import</span> <span class="n">app</span>


<span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_create_inexistent_item</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/create"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"item"</span> <span class="p">:</span> <span class="s">"new_item"</span><span class="p">,</span> <span class="s">"qty"</span> <span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">201</span>
    <span class="k">assert</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s">"data"</span> <span class="p">:</span> <span class="s">"new_item added correctly!"</span><span class="p">}</span>
    

<span class="k">def</span> <span class="nf">test_create_existent_item</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/create"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s">"item"</span> <span class="p">:</span> <span class="s">"bread"</span><span class="p">,</span> <span class="s">"qty"</span> <span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">400</span>
    <span class="k">assert</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s">"detail"</span> <span class="p">:</span> <span class="s">"bread already present!"</span><span class="p">}</span>
</code></pre></div></div><p>You can check all the tests that I have already performed <a href="https://github.com/francescodisalvo05/fastapi-grocery-list/blob/main/test/test_main.py">here</a>. To run all the tests, you need to run:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pytest
</code></pre></div></div><p>Since I have performed 8 tests, this would be my result:</p><p><img src="http://localhost:4000/assets/images/fastapi-grocery-list/pytest.png" alt="Pytest" /> <br /><br /></p><h2 id="conclusions"> Conclusions <a href="#conclusions">#</a></h2><p>Today we have seen how to build a simple local server that can be used for a lot of (more useful) use cases. Recently, I needed to build it for a coding interview, and to be honest, it was quite fun!</p><p>I hope everything is clear, and if not, feel free to reach out on <a href="https://www.linkedin.com/in/francescodisalvo-pa/">LinkedIn</a>. I would be more than happy to hear your feedback! <br /><br /></p><h2 id="references"> References <a href="#references">#</a></h2><ul><li>Wallpaper : https://unsplash.com/photos/8RaUEd8zD-U</li><li>Available code: https://github.com/francescodisalvo05/fastapi-grocery-list</li><li>GET and POST: https://www.w3schools.com/tags/ref_httpmethods.asp</li><li>APIs: https://www.redhat.com/en/topics/api/what-are-application-programming-interfaces</li><li>Status code: https://fastapi.tiangolo.com/tutorial/response-status-code/</li><li>Postman: https://www.postman.com</li></ul><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></section><section><nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/2021/09/06/curse-of-dimensionality"><div class="nav-arrow">Previous</div><span class="post-title">Curse of dimensionality</span> </a> <a class="post-nav-item post-nav-next" href="/2021/10/03/decision-tree-random-forest-1"><div class="nav-arrow">Next</div><span class="post-title">Decision Tree and Random Forest — PT 1</span> </a></nav></section></main><script> function setTheme(theme) { if (theme === "dark") { document.documentElement.setAttribute('data-theme', 'dark'); window.localStorage.setItem('theme', 'dark'); document.getElementById("theme-toggle").classList.add('sun'); document.getElementById("theme-toggle").classList.remove('moon'); } else { document.documentElement.setAttribute('data-theme', 'light'); window.localStorage.setItem('theme', 'light'); document.getElementById("theme-toggle").classList.add('moon'); document.getElementById("theme-toggle").classList.remove('sun'); } } let theme = localStorage.getItem('theme'); theme = theme || (window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' : 'light'); setTheme(theme); function modeSwitcher() { let currentMode = document.documentElement.getAttribute('data-theme'); if (currentMode === "dark") { setTheme('light'); } else { setTheme('dark'); } } </script></body><footer class="social-footer"><div class="social-footer-icons"> <a href="https://github.com/Ilsolang" title="Github profile, nothing much there, yet" target="_blank" rel="noopener noreferrer"><i class="fa fa-github" aria-hidden="true"></i></a> <a href="https://github.com/Ilsolang/Ilsolang.github.io" title="Browse the code" target="_blank" rel="noopener noreferrer"><i class="fa fa-code" aria-hidden="true"></i></a></div></footer></html>
